<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="zh">
<head>
<!-- Generated by javadoc -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>SnapshotFileCache (Apache HBase 3.0.0-SNAPSHOT API)</title>
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="SnapshotFileCache (Apache HBase 3.0.0-SNAPSHOT API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10};
var tabs = {65535:["t0","所有方法"],2:["t2","实例方法"],8:["t4","具体方法"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>您的浏览器已禁用 JavaScript。</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="跳过导航链接">跳过导航链接</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="导航">
<li><a href="../../../../../../overview-summary.html">概览</a></li>
<li><a href="package-summary.html">程序包</a></li>
<li class="navBarCell1Rev">类</li>
<li><a href="class-use/SnapshotFileCache.html">使用</a></li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../../../deprecated-list.html">已过时</a></li>
<li><a href="../../../../../../index-all.html">索引</a></li>
<li><a href="../../../../../../help-doc.html">帮助</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/MasterSnapshotVerifier.html" title="org.apache.hadoop.hbase.master.snapshot中的类"><span class="typeNameLink">上一个类</span></a></li>
<li><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.RefreshCacheTask.html" title="org.apache.hadoop.hbase.master.snapshot中的类"><span class="typeNameLink">下一个类</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html" target="_top">框架</a></li>
<li><a href="SnapshotFileCache.html" target="_top">无框架</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">所有类</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>概要:&nbsp;</li>
<li><a href="#nested.class.summary">嵌套</a>&nbsp;|&nbsp;</li>
<li><a href="#field.summary">字段</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">构造器</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">方法</a></li>
</ul>
<ul class="subNavList">
<li>详细资料:&nbsp;</li>
<li><a href="#field.detail">字段</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">构造器</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">方法</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.hadoop.hbase.master.snapshot</div>
<h2 title="类 SnapshotFileCache" class="title">类 SnapshotFileCache</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang中的类或接口">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>org.apache.hadoop.hbase.master.snapshot.SnapshotFileCache</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>所有已实现的接口:</dt>
<dd><a href="../../../../../../org/apache/hadoop/hbase/Stoppable.html" title="org.apache.hadoop.hbase中的接口">Stoppable</a></dd>
</dl>
<hr>
<br>
<pre>@InterfaceAudience.Private
 @InterfaceStability.Evolving
public class <a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.79">SnapshotFileCache</a>
extends <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang中的类或接口">Object</a>
implements <a href="../../../../../../org/apache/hadoop/hbase/Stoppable.html" title="org.apache.hadoop.hbase中的接口">Stoppable</a></pre>
<div class="block">Intelligently keep track of all the files for all the snapshots.
 <p>
 A cache of files is kept to avoid querying the <code>FileSystem</code> frequently. If there is a cache
 miss the directory modification time is used to ensure that we don't rescan directories that we
 already have in cache. We only check the modification times of the snapshot directories
 (/hbase/.snapshot/[snapshot_name]) to determine if the files need to be loaded into the cache.
 <p>
 New snapshots will be added to the cache and deleted snapshots will be removed when we refresh
 the cache. If the files underneath a snapshot directory are changed, but not the snapshot itself,
 we will ignore updates to that snapshot's files.
 <p>
 This is sufficient because each snapshot has its own directory and is added via an atomic rename
 <i>once</i>, when the snapshot is created. We don't need to worry about the data in the snapshot
 being run.
 <p>
 Further, the cache is periodically refreshed ensure that files in snapshots that were deleted are
 also removed from the cache.
 <p>
 A <a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.SnapshotFileInspector.html" title="org.apache.hadoop.hbase.master.snapshot中的接口"><code>SnapshotFileCache.SnapshotFileInspector</code></a> must be passed when creating <tt>this</tt> to
 allow extraction of files under /hbase/.snapshot/[snapshot name] directory, for each snapshot.
 This allows you to only cache files under, for instance, all the logs in the .logs directory or
 all the files under all the regions.
 <p>
 <tt>this</tt> also considers all running snapshots (those under /hbase/.snapshot/.tmp) as valid
 snapshots and will attempt to cache files from those snapshots as well.
 <p>
 Queries about a given file are thread-safe with respect to multiple queries and cache refreshes.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested.class.summary">
<!--   -->
</a>
<h3>嵌套类概要</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="嵌套类概要表, 列表嵌套类和解释">
<caption><span>嵌套类</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">限定符和类型</th>
<th class="colLast" scope="col">类和说明</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.RefreshCacheTask.html" title="org.apache.hadoop.hbase.master.snapshot中的类">SnapshotFileCache.RefreshCacheTask</a></span></code>
<div class="block">Simple helper task that just periodically attempts to refresh the cache</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.SnapshotDirectoryInfo.html" title="org.apache.hadoop.hbase.master.snapshot中的类">SnapshotFileCache.SnapshotDirectoryInfo</a></span></code>
<div class="block">Information about a snapshot directory</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(专用程序包) static interface&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.SnapshotFileInspector.html" title="org.apache.hadoop.hbase.master.snapshot中的接口">SnapshotFileCache.SnapshotFileInspector</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>字段概要</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="字段概要表, 列表字段和解释">
<caption><span>字段</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">限定符和类型</th>
<th class="colLast" scope="col">字段和说明</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Set.html?is-external=true" title="java.util中的类或接口">Set</a>&lt;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="java.lang中的类或接口">String</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#cache">cache</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.SnapshotFileInspector.html" title="org.apache.hadoop.hbase.master.snapshot中的接口">SnapshotFileCache.SnapshotFileInspector</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#fileInspector">fileInspector</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private org.apache.hadoop.fs.FileSystem</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#fs">fs</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#lastModifiedTime">lastModifiedTime</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static org.slf4j.Logger</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#LOG">LOG</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Timer.html?is-external=true" title="java.util中的类或接口">Timer</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#refreshTimer">refreshTimer</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private org.apache.hadoop.fs.Path</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#snapshotDir">snapshotDir</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html?is-external=true" title="java.util中的类或接口">Map</a>&lt;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="java.lang中的类或接口">String</a>,<a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.SnapshotDirectoryInfo.html" title="org.apache.hadoop.hbase.master.snapshot中的类">SnapshotFileCache.SnapshotDirectoryInfo</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#snapshots">snapshots</a></span></code>
<div class="block">This is a helper map of information about the snapshot directories so we don't need to rescan
 them if they haven't changed since the last time we looked.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#stop">stop</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>构造器概要</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="构造器概要表, 列表构造器和解释">
<caption><span>构造器</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">构造器和说明</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#SnapshotFileCache-org.apache.hadoop.conf.Configuration-long-java.lang.String-org.apache.hadoop.hbase.master.snapshot.SnapshotFileCache.SnapshotFileInspector-">SnapshotFileCache</a></span>(org.apache.hadoop.conf.Configuration&nbsp;conf,
                 long&nbsp;cacheRefreshPeriod,
                 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="java.lang中的类或接口">String</a>&nbsp;refreshThreadName,
                 <a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.SnapshotFileInspector.html" title="org.apache.hadoop.hbase.master.snapshot中的接口">SnapshotFileCache.SnapshotFileInspector</a>&nbsp;inspectSnapshotFiles)</code>
<div class="block">Create a snapshot file cache for all snapshots under the specified [root]/.snapshot on the
 filesystem.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#SnapshotFileCache-org.apache.hadoop.fs.FileSystem-org.apache.hadoop.fs.Path-long-long-java.lang.String-org.apache.hadoop.hbase.master.snapshot.SnapshotFileCache.SnapshotFileInspector-">SnapshotFileCache</a></span>(org.apache.hadoop.fs.FileSystem&nbsp;fs,
                 org.apache.hadoop.fs.Path&nbsp;rootDir,
                 long&nbsp;cacheRefreshPeriod,
                 long&nbsp;cacheRefreshDelay,
                 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="java.lang中的类或接口">String</a>&nbsp;refreshThreadName,
                 <a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.SnapshotFileInspector.html" title="org.apache.hadoop.hbase.master.snapshot中的接口">SnapshotFileCache.SnapshotFileInspector</a>&nbsp;inspectSnapshotFiles)</code>
<div class="block">Create a snapshot file cache for all snapshots under the specified [root]/.snapshot on the
 filesystem</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>方法概要</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="方法概要表, 列表方法和解释">
<caption><span id="t0" class="activeTableTab"><span>所有方法</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">实例方法</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">具体方法</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">限定符和类型</th>
<th class="colLast" scope="col">方法和说明</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>(专用程序包) <a href="https://docs.oracle.com/javase/8/docs/api/java/util/List.html?is-external=true" title="java.util中的类或接口">List</a>&lt;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="java.lang中的类或接口">String</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#getSnapshotsInProgress-org.apache.hadoop.hbase.master.snapshot.SnapshotManager-">getSnapshotsInProgress</a></span>(<a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotManager.html" title="org.apache.hadoop.hbase.master.snapshot中的类">SnapshotManager</a>&nbsp;snapshotManager)</code>&nbsp;</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html?is-external=true" title="java.lang中的类或接口">Iterable</a>&lt;org.apache.hadoop.fs.FileStatus&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#getUnreferencedFiles-java.lang.Iterable-org.apache.hadoop.hbase.master.snapshot.SnapshotManager-">getUnreferencedFiles</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html?is-external=true" title="java.lang中的类或接口">Iterable</a>&lt;org.apache.hadoop.fs.FileStatus&gt;&nbsp;files,
                    <a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotManager.html" title="org.apache.hadoop.hbase.master.snapshot中的类">SnapshotManager</a>&nbsp;snapshotManager)</code>
<div class="block">Check to see if any of the passed file names is contained in any of the snapshots.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#isStopped--">isStopped</a></span>()</code>&nbsp;</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#refreshCache--">refreshCache</a></span>()</code>&nbsp;</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#stop-java.lang.String-">stop</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="java.lang中的类或接口">String</a>&nbsp;why)</code>
<div class="block">Stop this service.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#triggerCacheRefreshForTesting--">triggerCacheRefreshForTesting</a></span>()</code>
<div class="block">Trigger a cache refresh, even if its before the next cache refresh.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>从类继承的方法&nbsp;java.lang.<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang中的类或接口">Object</a></h3>
<code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#clone--" title="java.lang中的类或接口">clone</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#equals-java.lang.Object-" title="java.lang中的类或接口">equals</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#finalize--" title="java.lang中的类或接口">finalize</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#getClass--" title="java.lang中的类或接口">getClass</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#hashCode--" title="java.lang中的类或接口">hashCode</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notify--" title="java.lang中的类或接口">notify</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notifyAll--" title="java.lang中的类或接口">notifyAll</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#toString--" title="java.lang中的类或接口">toString</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait--" title="java.lang中的类或接口">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-" title="java.lang中的类或接口">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-int-" title="java.lang中的类或接口">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>字段详细资料</h3>
<a name="LOG">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>LOG</h4>
<pre>private static final&nbsp;org.slf4j.Logger <a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.89">LOG</a></pre>
</li>
</ul>
<a name="stop">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>stop</h4>
<pre>private volatile&nbsp;boolean <a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.90">stop</a></pre>
</li>
</ul>
<a name="fs">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>fs</h4>
<pre>private final&nbsp;org.apache.hadoop.fs.FileSystem <a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.91">fs</a></pre>
</li>
</ul>
<a name="fileInspector">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>fileInspector</h4>
<pre>private final&nbsp;<a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.SnapshotFileInspector.html" title="org.apache.hadoop.hbase.master.snapshot中的接口">SnapshotFileCache.SnapshotFileInspector</a> <a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.92">fileInspector</a></pre>
</li>
</ul>
<a name="snapshotDir">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>snapshotDir</h4>
<pre>private final&nbsp;org.apache.hadoop.fs.Path <a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.93">snapshotDir</a></pre>
</li>
</ul>
<a name="cache">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>cache</h4>
<pre>private final&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/util/Set.html?is-external=true" title="java.util中的类或接口">Set</a>&lt;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="java.lang中的类或接口">String</a>&gt; <a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.94">cache</a></pre>
</li>
</ul>
<a name="snapshots">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>snapshots</h4>
<pre>private final&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html?is-external=true" title="java.util中的类或接口">Map</a>&lt;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="java.lang中的类或接口">String</a>,<a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.SnapshotDirectoryInfo.html" title="org.apache.hadoop.hbase.master.snapshot中的类">SnapshotFileCache.SnapshotDirectoryInfo</a>&gt; <a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.99">snapshots</a></pre>
<div class="block">This is a helper map of information about the snapshot directories so we don't need to rescan
 them if they haven't changed since the last time we looked.</div>
</li>
</ul>
<a name="refreshTimer">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>refreshTimer</h4>
<pre>private final&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/util/Timer.html?is-external=true" title="java.util中的类或接口">Timer</a> <a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.100">refreshTimer</a></pre>
</li>
</ul>
<a name="lastModifiedTime">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>lastModifiedTime</h4>
<pre>private&nbsp;long <a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.102">lastModifiedTime</a></pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>构造器详细资料</h3>
<a name="SnapshotFileCache-org.apache.hadoop.conf.Configuration-long-java.lang.String-org.apache.hadoop.hbase.master.snapshot.SnapshotFileCache.SnapshotFileInspector-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>SnapshotFileCache</h4>
<pre>public&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.116">SnapshotFileCache</a>(org.apache.hadoop.conf.Configuration&nbsp;conf,
                         long&nbsp;cacheRefreshPeriod,
                         <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="java.lang中的类或接口">String</a>&nbsp;refreshThreadName,
                         <a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.SnapshotFileInspector.html" title="org.apache.hadoop.hbase.master.snapshot中的接口">SnapshotFileCache.SnapshotFileInspector</a>&nbsp;inspectSnapshotFiles)
                  throws <a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="java.io中的类或接口">IOException</a></pre>
<div class="block">Create a snapshot file cache for all snapshots under the specified [root]/.snapshot on the
 filesystem.
 <p>
 Immediately loads the file cache.</div>
<dl>
<dt><span class="paramLabel">参数:</span></dt>
<dd><code>conf</code> - to extract the configured <code>FileSystem</code> where the snapshots are stored and
          hbase root directory</dd>
<dd><code>cacheRefreshPeriod</code> - frequency (ms) with which the cache should be refreshed</dd>
<dd><code>refreshThreadName</code> - name of the cache refresh thread</dd>
<dd><code>inspectSnapshotFiles</code> - Filter to apply to each snapshot to extract the files.</dd>
<dt><span class="throwsLabel">抛出:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="java.io中的类或接口">IOException</a></code> - if the <code>FileSystem</code> or root directory cannot be loaded</dd>
</dl>
</li>
</ul>
<a name="SnapshotFileCache-org.apache.hadoop.fs.FileSystem-org.apache.hadoop.fs.Path-long-long-java.lang.String-org.apache.hadoop.hbase.master.snapshot.SnapshotFileCache.SnapshotFileInspector-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>SnapshotFileCache</h4>
<pre>public&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.132">SnapshotFileCache</a>(org.apache.hadoop.fs.FileSystem&nbsp;fs,
                         org.apache.hadoop.fs.Path&nbsp;rootDir,
                         long&nbsp;cacheRefreshPeriod,
                         long&nbsp;cacheRefreshDelay,
                         <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="java.lang中的类或接口">String</a>&nbsp;refreshThreadName,
                         <a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.SnapshotFileInspector.html" title="org.apache.hadoop.hbase.master.snapshot中的接口">SnapshotFileCache.SnapshotFileInspector</a>&nbsp;inspectSnapshotFiles)</pre>
<div class="block">Create a snapshot file cache for all snapshots under the specified [root]/.snapshot on the
 filesystem</div>
<dl>
<dt><span class="paramLabel">参数:</span></dt>
<dd><code>fs</code> - <code>FileSystem</code> where the snapshots are stored</dd>
<dd><code>rootDir</code> - hbase root directory</dd>
<dd><code>cacheRefreshPeriod</code> - period (ms) with which the cache should be refreshed</dd>
<dd><code>cacheRefreshDelay</code> - amount of time to wait for the cache to be refreshed</dd>
<dd><code>refreshThreadName</code> - name of the cache refresh thread</dd>
<dd><code>inspectSnapshotFiles</code> - Filter to apply to each snapshot to extract the files.</dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>方法详细资料</h3>
<a name="triggerCacheRefreshForTesting--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>triggerCacheRefreshForTesting</h4>
<pre>public&nbsp;void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.151">triggerCacheRefreshForTesting</a>()</pre>
<div class="block">Trigger a cache refresh, even if its before the next cache refresh. Does not affect pending
 cache refreshes.
 <p>
 Blocks until the cache is refreshed.
 <p>
 Exposed for TESTING.</div>
</li>
</ul>
<a name="getUnreferencedFiles-java.lang.Iterable-org.apache.hadoop.hbase.master.snapshot.SnapshotManager-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getUnreferencedFiles</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html?is-external=true" title="java.lang中的类或接口">Iterable</a>&lt;org.apache.hadoop.fs.FileStatus&gt;&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.181">getUnreferencedFiles</a>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html?is-external=true" title="java.lang中的类或接口">Iterable</a>&lt;org.apache.hadoop.fs.FileStatus&gt;&nbsp;files,
                                                                      <a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotManager.html" title="org.apache.hadoop.hbase.master.snapshot中的类">SnapshotManager</a>&nbsp;snapshotManager)
                                                               throws <a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="java.io中的类或接口">IOException</a></pre>
<div class="block">Check to see if any of the passed file names is contained in any of the snapshots.
 First checks an in-memory cache of the files to keep. If its not in the cache, then the cache
 is refreshed and the cache checked again for that file.
 This ensures that we never return files that exist.
 <p>
 Note this may lead to periodic false positives for the file being referenced. Periodically, the
 cache is refreshed even if there are no requests to ensure that the false negatives get removed
 eventually. For instance, suppose you have a file in the snapshot and it gets loaded into the
 cache. Then at some point later that snapshot is deleted. If the cache has not been refreshed
 at that point, cache will still think the file system contains that file and return
 <tt>true</tt>, even if it is no longer present (false positive). However, if the file never was
 on the filesystem, we will never find it and always return <tt>false</tt>.</div>
<dl>
<dt><span class="paramLabel">参数:</span></dt>
<dd><code>files</code> - file to check, NOTE: Relies that files are loaded from hdfs before method
              is called (NOT LAZY)</dd>
<dt><span class="returnLabel">返回:</span></dt>
<dd><tt>unReferencedFiles</tt> the collection of files that do not have snapshot references</dd>
<dt><span class="throwsLabel">抛出:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="java.io中的类或接口">IOException</a></code> - if there is an unexpected error reaching the filesystem.</dd>
</dl>
</li>
</ul>
<a name="refreshCache--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>refreshCache</h4>
<pre>private&nbsp;void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.207">refreshCache</a>()
                   throws <a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="java.io中的类或接口">IOException</a></pre>
<dl>
<dt><span class="throwsLabel">抛出:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="java.io中的类或接口">IOException</a></code></dd>
</dl>
</li>
</ul>
<a name="getSnapshotsInProgress-org.apache.hadoop.hbase.master.snapshot.SnapshotManager-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getSnapshotsInProgress</h4>
<pre><a href="https://docs.oracle.com/javase/8/docs/api/java/util/List.html?is-external=true" title="java.util中的类或接口">List</a>&lt;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="java.lang中的类或接口">String</a>&gt;&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.272">getSnapshotsInProgress</a>(<a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotManager.html" title="org.apache.hadoop.hbase.master.snapshot中的类">SnapshotManager</a>&nbsp;snapshotManager)
                             throws <a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="java.io中的类或接口">IOException</a></pre>
<dl>
<dt><span class="throwsLabel">抛出:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="java.io中的类或接口">IOException</a></code></dd>
</dl>
</li>
</ul>
<a name="stop-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>stop</h4>
<pre>public&nbsp;void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.321">stop</a>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="java.lang中的类或接口">String</a>&nbsp;why)</pre>
<div class="block"><span class="descfrmTypeLabel">从接口复制的说明:&nbsp;<code><a href="../../../../../../org/apache/hadoop/hbase/Stoppable.html#stop-java.lang.String-">Stoppable</a></code></span></div>
<div class="block">Stop this service.
 Implementers should favor logging errors over throwing RuntimeExceptions.</div>
<dl>
<dt><span class="overrideSpecifyLabel">指定者:</span></dt>
<dd><code><a href="../../../../../../org/apache/hadoop/hbase/Stoppable.html#stop-java.lang.String-">stop</a></code>&nbsp;在接口中&nbsp;<code><a href="../../../../../../org/apache/hadoop/hbase/Stoppable.html" title="org.apache.hadoop.hbase中的接口">Stoppable</a></code></dd>
<dt><span class="paramLabel">参数:</span></dt>
<dd><code>why</code> - Why we're stopping.</dd>
</dl>
</li>
</ul>
<a name="isStopped--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>isStopped</h4>
<pre>public&nbsp;boolean&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html#line.330">isStopped</a>()</pre>
<dl>
<dt><span class="overrideSpecifyLabel">指定者:</span></dt>
<dd><code><a href="../../../../../../org/apache/hadoop/hbase/Stoppable.html#isStopped--">isStopped</a></code>&nbsp;在接口中&nbsp;<code><a href="../../../../../../org/apache/hadoop/hbase/Stoppable.html" title="org.apache.hadoop.hbase中的接口">Stoppable</a></code></dd>
<dt><span class="returnLabel">返回:</span></dt>
<dd>True if <a href="../../../../../../org/apache/hadoop/hbase/Stoppable.html#stop-java.lang.String-"><code>Stoppable.stop(String)</code></a> has been closed.</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="跳过导航链接">跳过导航链接</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="导航">
<li><a href="../../../../../../overview-summary.html">概览</a></li>
<li><a href="package-summary.html">程序包</a></li>
<li class="navBarCell1Rev">类</li>
<li><a href="class-use/SnapshotFileCache.html">使用</a></li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../../../deprecated-list.html">已过时</a></li>
<li><a href="../../../../../../index-all.html">索引</a></li>
<li><a href="../../../../../../help-doc.html">帮助</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/MasterSnapshotVerifier.html" title="org.apache.hadoop.hbase.master.snapshot中的类"><span class="typeNameLink">上一个类</span></a></li>
<li><a href="../../../../../../org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.RefreshCacheTask.html" title="org.apache.hadoop.hbase.master.snapshot中的类"><span class="typeNameLink">下一个类</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/apache/hadoop/hbase/master/snapshot/SnapshotFileCache.html" target="_top">框架</a></li>
<li><a href="SnapshotFileCache.html" target="_top">无框架</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">所有类</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>概要:&nbsp;</li>
<li><a href="#nested.class.summary">嵌套</a>&nbsp;|&nbsp;</li>
<li><a href="#field.summary">字段</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">构造器</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">方法</a></li>
</ul>
<ul class="subNavList">
<li>详细资料:&nbsp;</li>
<li><a href="#field.detail">字段</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">构造器</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">方法</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2007&#x2013;2018 <a href="https://www.apache.org/">The Apache Software Foundation</a>. All rights reserved.</small></p>
</body>
</html>
